<!DOCTYPE html>
<!--!
@license
Copyright (c) 2017 The Contrast Tool Authors. All rights reserved.
This code may only be used under the BSD style license found at https://contrast-tool.github.io/static/LICENSE.md
The complete set of authors may be found at https://contrast-tool.github.io/static/AUTHORS.md
The complete set of contributors may be found at https://contrast-tool.github.io/static/CONTRIBUTORS.md
-->
<html lang="en-NL" dir="ltr">

<head>
  <base href="/">
  <title>Contrast Tool - OAuth2</title>

  <!-- <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@7/dist/polyfill.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.js"></script> -->
  <!-- <script src="/node_modules/dropbox/dist/Dropbox-sdk.min.js"></script> -->
  <script>
    const parseQueryString = (str) => {
      let ret = Object.create(null);

      if (typeof str !== 'string') { return ret; }

      str = str.trim().replace(/^(\?|#|&)/, '');
      if (!str) { return ret; }

      str.split('&').forEach((param) => {
        let parts = param.replace(/\+/g, ' ').split('=');
        let key = parts.shift();
        let val = parts.length > 0 ? parts.join('=') : undefined;

        key = decodeURIComponent(key);

        val = val === undefined ? null : decodeURIComponent(val);

        if (ret[key] === undefined) {
          ret[key] = val;
        } else if (Array.isArray(ret[key])) {
          ret[key].push(val);
        } else {
          ret[key] = [ret[key], val];
        }
      });

      return ret;
    }
      
    if (!self.opener) self.location.href = self.location.origin;

    const AppKey = 'dlxog8x736ba0rl';
    const AuthRedirectURI = `${self.location.origin}${self.location.pathname}`
    const AuthParams = parseQueryString(self.location.hash);

    if (Object.keys(AuthParams).length) {
      self.opener.dispatchEvent(new CustomEvent('oauth:done', { detail: AuthParams}));
    } else {
      let OAuth2Uri = `https://www.dropbox.com/oauth2/authorize?`;
      OAuth2Uri += `response_type=token`;
      OAuth2Uri += `&client_id=${AppKey}`;
      OAuth2Uri += `&redirect_uri=${AuthRedirectURI}`;

      self.location.href = OAuth2Uri;
    };



  </script>
</head>

</html>