<!--
@license
Copyright (c) 2019 The Contrast Tool Authors. All rights reserved.
This code may only be used under the BSD style license found at https://contrast-tool.github.io/docs/LICENSE.md
The complete set of authors may be found at https://contrast-tool.github.io/docs/AUTHORS.md
The complete set of contributors may be found at https://contrast-tool.github.io/docs/CONTRIBUTORS.md
-->

<!doctype html>
<html lang="en-NL" dir="ltr">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=no">

	<title>Contrast Tool</title>
	<meta name="description" content="An interactive viewer to test, compare and export your chat graphics.">
	<meta name="author" content="Rikkun Brouwers">

	<!--
		The `<base>` tag below is present to support two advanced deployment options:
		1) Differential serving. 2) Serving from a non-root path.

		Instead of manually editing the `<base>` tag yourself, you should generally either:
		a) Add a `basePath` property to the build configuration in your `polymer.json`.
		b) Use the `--base-path` command-line option for `polymer build`.

		Note: If you intend to serve from a non-root path, see [polymer-root-path] below.
	-->
	<base href="/">

	<link rel="icon" href="images/favicon.ico">

	<!-- See https://goo.gl/OOhYW5 -->
	<link rel="manifest" href="manifest.json">

	<!-- See https://goo.gl/qRE0vM -->
	<meta name="theme-color" content="#f57b67">

	<!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="application-name" content="Contrast Tool">

	<!-- Add to homescreen for Safari on iOS -->
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-title" content="Contrast Tool">

	<!-- Homescreen icons -->
	<link rel="apple-touch-icon" href="images/manifest/icon-48x48.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/manifest/icon-72x72.png">
	<link rel="apple-touch-icon" sizes="96x96" href="images/manifest/icon-96x96.png">
	<link rel="apple-touch-icon" sizes="144x144" href="images/manifest/icon-144x144.png">
	<link rel="apple-touch-icon" sizes="192x192" href="images/manifest/icon-192x192.png">

	<!-- Tile icon for Windows 8 (144x144 + tile color) -->
	<meta name="msapplication-TileImage" content="images/manifest/icon-144x144.png">
	<meta name="msapplication-TileColor" content="#f57b67">
	<meta name="msapplication-tap-highlight" content="no">

	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Roboto:300,400,500|Material+Icons+Sharp">
	<style>
		body {
			margin: 0;
			height: 100vh;
			background-color: #eeeeee; }
	
		body {
			opacity: 1 !important;
			transition: none !important; }

	</style>

	<script>
		// Web applic
		self.applic = new class {
			constructor() {
				this.__proto__.rootPath = '/';
				this.__proto__.created = Date.now();
				this.__proto__.rendered = false;
			}
		};

		// A2HS support
		if (window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches) { 
			console.info('A2HS is active'); 
			// I have no idea if it's possible to trigger opening the app.
			// https://developers.google.com/web/fundamentals/app-install-banners/
		} else {
			self.addEventListener('beforeinstallprompt', (_event) => {
				applic.deferredPrompt = _event;  console.info('A2HS is available');
				applic.deferredPrompt.preventDefault();

				applic.deferredInstall = () => {
					applic.deferredPrompt.prompt().catch((_error) => console.error );
					applic.deferredPrompt.userChoice.then((_result) => {
						if (_result.outcome === 'accepted') {
							console.info('User accepted the A2HS prompt');
						} else {
							console.info('User dismissed the A2HS prompt');
						};

						applic.utils.buffer(() => {
							applic.deferredPrompt = null;
							applic.deferredInstall = () => { };
						})
					});
				};

				// TODO: Add an in-applic install prompt.
				setTimeout(() => {
					applic.deferredInstall();
				}, 1000 * 2)
			});
		}

		// ServiceWorker
		if ('serviceWorker' in navigator) {
			self.addEventListener('load', () => {	
				navigator.serviceWorker.register('service-worker.js', { scope: applic.rootPath })
					.then((_sw) => { applic.__proto__.sw = _sw})
			});
		};

	</script>



	<script src="node_modules/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>

	<script type="module" src="src/applic.wireframe.js"></script>

	<script type="module" src="src/applic.js"></script>
	<script type="module" src="src/applic.lazies.js"></script>

</head>

<body>
	<applic-mount></applic-mount>
	<noscript>Please enable JavaScript to view this application.</noscript>

	<script>
		requestAnimationFrame(() => { self.applic.__proto__.rendered = true; });
		requestAnimationFrame(() => { console.debug('--- first frame ---'); });
	</script>
</body>

</html>